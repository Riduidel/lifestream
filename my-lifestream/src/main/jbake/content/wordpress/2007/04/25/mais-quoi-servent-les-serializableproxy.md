type: post
status: published
title: Mais ?? quoi servent les SerializableProxy
tags: code, informatique, java
date: Wed Apr 25 16:25:16 CEST 2007
~~~~~~
# Mais ?? quoi servent les SerializableProxy

Dans l'application sur laquelle je travaille, on se retrouve parfois avec des SerializableProxy d'Hibernate (sans doute au moment o?? on s??rialise nos objets pour les envoyer au client Spring remoting).Et je ne comprend vraiment pas ?? quoi servent ces objets.On a bien droit ?? la javadoc de Gavin King qui nous dit (je cite int??gralement) Serializable placeholder for CGLIB proxies J'imagine donc (en particulier gr??ce ?? la pr??sence d'une m??thode [readResolve](http://java.sun.com/j2se/1.3/docs/guide/serialization/spec/input.doc6.html#5903), voir aussi l'impl??mentation chez [koders](http://www.koders.com/java/fidEF04FC5CBAFCA59934DA0E74002A118CD62ACDCE.aspx?s=serializableproxy)) que ces objets sont faits pour ??tre remplac??s par des HibernateProxy. Seulement voil??, quand on regarde l'impl??mentation de readResolve, elle utilise un appel ?? [CGLIBLazyInitializer](http://www.koders.com/java/fid5119E747B7C05277E28B3A4FE0B0FEDFF3C583EF.aspx?s=CGLIBLazyInitializer), et en particulier ?? la m??thode [JAVA]static HibernateProxy getProxy(         final Class persistentClass,         final Class[] interfaces,         final Method getIdentifierMethod,         final Method setIdentifierMethod,         final Serializable id,         final SessionImplementor session) [/JAVA]Seulement voil??, si vous regardez attentivement le code de SerializableProxy, et en particulier la ligne [55](http://www.koders.com/java/fidEF04FC5CBAFCA59934DA0E74002A118CD62ACDCE.aspx?s=serializableproxy#L55), vous constaterez comme moi que la session pass??e en argument est null. Dans ces conditions, comment Hibernate peut-il recr??er un HibernateProxy ? La r??ponse est simple : il ne peut pas.Du coup, avec un coll??gue, fatigu??s de tomber sur ces cochonneries de SerializableProxy, on a trouv?? la solution : utiliser l'introspection pour r??cup??rer tous les champs du SerializableProxy, invoquer explicitement la m??thode [CGLIBLazyInitializer.getProxy](http://www.koders.com/java/fid5119E747B7C05277E28B3A4FE0B0FEDFF3C583EF.aspx?s=CGLIBLazyInitializer#L54) et travailler notre HibernateProxy pour le retransformer en objet authentique. Ca marche, mais qu'est-ce que c'est laid !A mon sens, c'est le signe qu'on a loup?? quelque chose, mais quoi ?via [Nicolas Delsaux's posterous import script](http://riduidel.posterous.com/quest-ce-que-cest-que-ce-flux-qui-clignote)