type: post
status: published
title: continuations on the web : managing back and next in Struts
tags: code, informatique, java
date: Tue Jan 18 16:12:00 CET 2005
~~~~~~
# continuations on the web : managing back and next in Struts

Hier, j'ai lu avec beaucoup d'intérêt l'article de DeveloperWorks [Use continuations to develop complex Web applications](http://www-106.ibm.com/developerworks/library/j-contin.html).

J'ai été illuminé par le concept des continuations et son utilisation pour stocker l'état d'une application web. Cependant, ces continuations soulèvent des questions importantes pour moi comme : comment pourrais-je implémenter facilement une application basée sur les continuations s'intégrant bien dans, par exemple,  Struts.

Je réalise maintenant que toute mon illumination pour résoudre le problème "complexe" du précédent/suivant n'est qu'un jeu de l'esprit. En fait, la solution est triviale, quand on (en l'occurence moi), se souvient qu'une application web n'est jamais MVC, mais conversationnelle. Mais, pour m'en souvenir, la solution est simplement, pour un formulaire, de mettre dans la session de l'utilisateur, dans une clé nommée d'après le formulaire une valeur, qui sera détruite lors du traitement de ce formulaire. Si la clé n'est pas présente, aucun traitement de formulaire ne sera fait. Le principal avantage est que ce traitement peut être fait dans une paire d'actions abstraites, permettant un traitement facilité des formulaires, avec par exemple une AbsstractFormDisplayAction, et une AbstractFormReceiveAction.  Le truc est de rendre ces classes non visibles, ou non impactantes, sur les sous-classes. Pour ça, la AbsstractFormDisplayAction doit passer la clé utilisée à la JSP, qui pourra la placer dans un champ bien connu du formulaire. Cela permettra à la AbstractFormReceiveAction de lire cette valeur du formulaire, et ainsi de vérifier si la clé existe dans la session. Cependant, quand plusieurs fenêtres du navigateur partagent la même session, les choses deviennent encore un peu plus complexes (pensez aux deadlocks). Heureusement sur le web les choses sont simples : la AbsstractFormDisplayAction va associer à la clé, si ça n'est pas encore fait, une List, et créer dans cette liste un ID. Cet ID sera également passé à la JSP, et inséré dans le formulaire avec un bon nom. Ainsi, la AbstractFormReceiveAction pourra vérifier dans la liste si cet ID est présent, et sinon .... Quoi ? Afin de rendre cette implémentation efficace, les actions de formulaires devraient avoir toutes un forward, par exemple "formNotSubmitted", que la AbstractFormReceiveAction pourrait utiliser.via [Nicolas Delsaux's posterous import script](http://riduidel.posterous.com/quest-ce-que-cest-que-ce-flux-qui-clignote)